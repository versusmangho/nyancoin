<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1200">
  <title>ì˜¤ë²„í•„ë“œ ëƒ¥ì½”ì¸ ê³„ì‚°ê¸°</title>
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
  <style>
    :root {
      /* Base Theme (Light - Calculator Default) */
      --primary-color: #4f46e5;
      --bg-color: #f8fafc;
      --card-bg: #ffffff;
      --panel-bg: #f1f5f9;
      --text-main: #1e293b;
      --text-sub: #64748b;
      --border-color: #e2e8f0;
    }

    /* Dark Theme Overrides (From Composer) */
    [data-theme="dark"] {
      --primary-color: #ce93d8;
      --bg-color: #1a1a2e;
      --card-bg: #16213e;
      --panel-bg: rgba(0,0,0,0.2);
      --text-main: #ffffff;
      --text-sub: #94a3b8;
      --border-color: #2a2a4e;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; }

    body { background-color: var(--bg-color); color: var(--text-main); padding: 20px; transition: background-color 0.3s, color 0.3s; }

    .container { max-width: 1000px; margin: 0 auto; }

    header { margin-bottom: 30px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
    
    .nav-header {
        width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
    }
    .nav-btn {
        text-decoration: none; font-size: 0.9rem; font-weight: bold; color: var(--text-sub);
        padding: 8px 12px; border-radius: 8px; background: var(--panel-bg); transition: 0.2s;
        display: flex; align-items: center; gap: 5px; border: 1px solid var(--border-color);
    }
    .nav-btn:hover { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    
    .theme-toggle {
        background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 5px;
    }

    header h1 { font-size: 24px; margin-bottom: 10px; }

    /* 3-2-3 ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
    .grid-layout { display: flex; flex-direction: column; gap: 20px; align-items: center; }
    .row { display: flex; gap: 20px; width: 100%; justify-content: center; }
    .row-3 { max-width: 1000px; } 
    .row-2 { max-width: 700px; }  

    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      width: 100%;
      flex: 1;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: transform 0.2s, background-color 0.3s, border-color 0.3s;
      min-height: 340px; 
      display: flex;
      flex-direction: column;
    }
    .card:focus-within { border-color: var(--primary-color); transform: translateY(-2px); }

    .input-group { margin-bottom: 10px; display: flex; flex-direction: column; }
    .input-group label { font-size: 12px; color: var(--text-sub); font-weight: bold; }
    .input-group .input,
    .input-group .select-box { margin-top: 5px; }

    /* í™˜ê²½ì„¤ì • ê·¸ë£¹ */
    .settings-group {
      display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px;
      padding: 25px 15px 15px 15px;
      background-color: var(--panel-bg);
      border-radius: 8px; border: 1px solid var(--border-color);
    }
    .settings-group .input-group { flex-direction: row; align-items: center; gap: 10px; }
    .settings-group .input-group label { white-space: nowrap; }
    .settings-group .input-group .input { width: 100px; margin-top: 0 !important; }

    /* ê²°ê³¼ì°½ */
    .result-box {
      margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border-color);
      font-size: 14px; display: none; 
    }
    .result-box.active { display: block; }
    .badge {
      display: inline-block; padding: 2px 6px; border-radius: 4px; 
      font-size: 11px; font-weight: bold; margin-bottom: 4px;
    }
    .badge.good { background: #dcfce7; color: #166534; }
    .badge.warn { background: #fef9c3; color: #854d0e; }
    .badge.bad { background: #fee2e2; color: #991b1b; }
    .badge.info { background: #e0f2fe; color: #075985; }

    .stat-row { display: flex; justify-content: space-between; margin-top: 4px; }
    .profit { color: var(--primary-color); font-weight: bold; }

    /* ê³µí†µ í¼ ìš”ì†Œ */
    .input, .select-box, textarea {
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.5; 
      vertical-align: middle;
      outline: none;
      width: 100%;
      background-color: var(--bg-color);
      color: var(--text-main);
    }
    .input:focus, .select-box:focus, textarea:focus { border-color: var(--primary-color); }

    /* ì—ë””í„° ìŠ¤íƒ€ì¼ */
    .editor-section { 
        background: var(--card-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px; 
        border: 1px solid var(--border-color); 
    }
    .editor-list { 
        max-height: 300px; overflow-y: auto; margin-top: 10px; 
        border: 1px solid var(--border-color); border-radius: 6px; 
    }
    .list-item { 
        display: flex; justify-content: space-between; padding: 10px; 
        border-bottom: 1px solid var(--border-color); align-items: center; 
    }
    .list-subheader {
      padding: 8px 10px;
      background-color: var(--panel-bg);
      color: var(--primary-color);
      font-size: 13px; font-weight: bold;
      border-bottom: 1px solid var(--border-color);
    }
    .btn {
      padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold;
      background: var(--primary-color); color: white;
      transition: filter 0.2s;
    }
    .btn:hover { filter: brightness(1.1); }
    .btn-sm { padding: 4px 8px; font-size: 12px; background: #ef4444; }
    .btn-secondary { background: var(--text-sub); }

    /* Summary */
    #total-summary { justify-content: center; }
    #total-summary h3 { text-align: center; margin-bottom: 15px; }

    .summary-stats-container { display: flex; flex-direction: column; gap: 10px; }

    .summary-stat {
      display: flex; flex-direction: column; align-items: center;
      padding: 5px; border-radius: 8px;
      background-color: var(--panel-bg);
    }
    .summary-stat span { font-size: 12px; color: var(--text-sub); }
    .summary-stat b { font-size: 16px; font-weight: bold; }

    #clipboard-section { min-height: auto; max-width: 700px; margin: 20px auto 0 auto; }
    #clipboard-section h3 { text-align: center; margin-bottom: 15px; }
    #clipboard-section .btn-group { margin-top: 10px; display: flex; gap: 10px; justify-content: center; }
    .btn.copied { background-color: #16a34a; }

    /* Local File Section */
    #localTestModeSection {
        margin-top: 15px; padding: 10px; background: var(--panel-bg) !important; 
        border: 1px dashed var(--text-sub) !important; border-radius: 8px; display: inline-block; text-align: left;
    }
    #localTestModeSection p { color: var(--text-sub) !important; }
  </style>
</head>
<body>
  <div class="container" id="calculator-app">
    <header>
      <div class="nav-header">
          <a href="composer.html" class="nav-btn">ì•…ë³´ ì—ë””í„°</a>
          <button class="theme-toggle" onclick="toggleTheme()" title="í…Œë§ˆ ë³€ê²½">ğŸŒ™</button>
      </div>

      <h1>ê°œì¸í™” ëƒ¥ì½”ì¸ íš¨ìœ¨í‘œ</h1>

      <!-- í™˜ê²½ì„¤ì • ê·¸ë£¹ -->
      <div class="settings-group">
        <div class="input-group">
          <label for="efficiencyLimit">ë§ˆì§€ë…¸ì„  íš¨ìœ¨</label>
          <input type="number" id="efficiencyLimit" class="input" step="0.01" value="0.36">
        </div>
        <div class="input-group">
          <label for="conservationLevel">ì ˆì•½ ë ˆë²¨</label>
          <input type="number" id="conservationLevel" class="input" min="0" max="10" step="1" value="10">
        </div>
        <div class="input-group">
          <label for="wlbLevel">ì›Œë¼ë°¸ ë ˆë²¨</label>
          <input type="number" id="wlbLevel" class="input" min="0" max="10" step="1" value="10">
        </div>
        <div class="input-group">
          <label for="staminaCost">ìŠ¤íƒœë¯¸ë‚˜ 1ë‹¹ ê°€ì¹˜</label>
          <input type="number" id="staminaCost" class="input" step="0.01" value="8.55">
        </div>
        <div class="input-group">
          <label for="ignoreIntermediateStamina">ì¤‘ê°„ì¬ë£Œ ìŠ¤íƒœë¯¸ë‚˜ ë¯¸í¬í•¨</label>
          <input type="checkbox" id="ignoreIntermediateStamina" class="checkbox" checked>        
        </div>
      </div>

      <div id="localTestModeSection">
        <p>âš ï¸ <b>ë¡œì»¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œ:</b> ë°ì´í„°ê°€ ì•ˆ ë³´ì¸ë‹¤ë©´ ë‹¤ìš´ë¡œë“œ ë°›ì€ <b>data.json</b>ì„ ì„ íƒí•˜ì„¸ìš”.</p>
        <input type="file" id="calcFileInput" accept=".json" style="font-size: 12px;">
      </div>
    </header>

    <!-- ìë™ì™„ì„± ë°ì´í„°ë¦¬ìŠ¤íŠ¸ -->
    <datalist id="itemList"></datalist>

    <!-- 3-2-3 ê·¸ë¦¬ë“œê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
    <div id="grid-container" class="grid-layout"></div>

    <div style="text-align: center; margin-top: 20px;">
      <button id="captureBtn" class="btn">ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
    </div>

    <!-- í´ë¦½ë³´ë“œ ê°€ì ¸ì˜¤ê¸°/ë‚´ë³´ë‚´ê¸° -->
    <div id="clipboard-section" class="card">
      <h3>ì •ë³´ ì¼ê´„ ì…ì¶œë ¥</h3>
      <textarea id="clipboard-data" class="input" rows="4" placeholder="ì˜ˆì‹œ : ì¹˜ë§ˆ ìƒ˜í”Œ 800, ë°”ì§€ ìƒ˜í”Œ 600, ì•ˆê²½ ìƒ˜í”Œ 800, ë§¤ì‰¬ë“œ í¬í…Œì´í†  300, í¸ìœ¡ 150, ì˜¤ì§•ì–´ë³¶ìŒë©´ 600, ìƒì„  ê¼¬ì¹˜êµ¬ì´ 600, í¬ë¦¼ í™í•©ì°œ 800"></textarea>
      <div class="btn-group">
        <button id="importBtn" class="btn">ë¶™ì—¬ë„£ê¸°</button>
        <button id="exportBtn" class="btn">ë³µì‚¬í•˜ê¸°</button>
      </div>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- ê¸°ì¡´ ë¡œì§ ìŠ¤í¬ë¦½íŠ¸ ì—°ê²° ìœ ì§€ -->
  <script src="./script.js"></script>
  
  <script>
    // --- Theme Logic ---
    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        body.setAttribute('data-theme', next);
        localStorage.setItem('overfield_theme', next);
        updateThemeBtn(next);
    }

    function updateThemeBtn(theme) {
        const btn = document.querySelector('.theme-toggle');
        btn.innerText = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }

    // Initialize Theme
    const savedTheme = localStorage.getItem('overfield_theme') || 'light';
    document.body.setAttribute('data-theme', savedTheme);
    updateThemeBtn(savedTheme);
  </script>
</body>
</html>